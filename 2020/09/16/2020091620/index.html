<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="theme-color" content="#4fc08d"><meta name="msapplication-TileColor" content="#4fc08d"><title> 远程启动不支持网络唤醒的pc · Just4fun</title><meta name="description" content="远程启动不支持网络唤醒的pc - coolrc"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://coolrc.me/atom.xml" title="Just4fun"><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-71864657-1",'auto');ga('send','pageview');</script><script src="//code.jquery.com/jquery-2.2.0.min.js"></script><link rel="stylesheet" href="/css/jquery.fancybox.min.css"><script src="/js/jquery.fancybox.min.js"></script><script src="/js/wrapimage.js"></script></head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/friends/" target="_self">LINKS</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/coolrc136" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">远程启动不支持网络唤醒的pc</h1><div class="post-info">Sep 16, 2020</div><div class="post-content"><hr>
<h2 id="update-修改了代码，现在可以实时检测电脑是否在线"><a href="#update-修改了代码，现在可以实时检测电脑是否在线" class="headerlink" title="update: 修改了代码，现在可以实时检测电脑是否在线"></a>update: 修改了代码，现在可以实时检测电脑是否在线</h2><blockquote>
<p><code>Wake-on-LAN</code>简称<code>WOL</code>或<code>WoL</code>，中文多译为“网络唤醒”、“远程唤醒”技术。WOL是一种技术，同时也是该技术的规范标准，它的功效在于让休眠状态或关机状态的电脑，透过局域网的另一台电脑对其发令，使其唤醒、恢复成运作状态，或从关机状态转成引导状态。</p>
</blockquote>
<p>对于支持网络唤醒的主机，我们可以使用路由器的网络唤醒功能来开机。但是网络唤醒需要的是网卡和主板的支持，还需要你有公网ip或者路由器支持远程唤醒，任何一项不支持都不能正常启动。而且即使支持了网络唤醒，万一遇到了意外断电，有的主板也不能正常开机。<a id="more"></a>那么有什么办法能保证网络唤醒一定成功呢？</p>
<p>最简单的方法是智能插座，在BIOS里设置好主板通电就开机，然后远程控制智能插座就可以了。这种方法最简单，但是笔记本是有电池的，所以BIOS里一般没有通电开机的选项，这个办法就行不通了。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>那么怎么办呢，首先我们来了解一下电脑的启动流程：<br>开机按键一端和电源14脚或16脚相接，另一端接地，当我们按下电源按钮时，电源的14或16脚接地，然后就会触发电源开始工作，向设备供电。（这种说法只是为了方便理解，实际流程很复杂）</p>
<p>既然知道了这个原理，那我们只要让电源引脚接地，模拟开机键按下的过程，不就能开机了吗。</p>
<p>为了实现这个功能，需要以下材料：</p>
<ul>
<li>一个esp8266，用于联网</li>
<li>一个esp8266 relay，用于短接电源引脚，</li>
<li>一个usb转ttl，同于给esp8266刷写程序</li>
<li>电烙铁，用于引出开机线路</li>
<li>一个万用表，用于测试</li>
<li>esp8266开发软件，我用的是arduino IDE</li>
</ul>
<h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><p>首先需要的，当然是拆开电脑，找到对应的启动引脚了，台式机的话很简单，看电源按钮排线就行，笔记本的话，可以直接看电源按钮的线路，也可以找根线，一端接地，一端在电源按钮排线上一个一个短接试过去。</p>
<p>找到引脚后，就要想办法用电烙铁引过来地线和电源线，这里推荐用耳机线，很软很细不容易断，不会让设备外壳合不上。</p>
<p>然后把这两根线接到继电器的公共口和常闭口就行。</p>
<h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><p>接着就要写程序远程控制继电器开合。推荐使用点灯科技的<code>blinker</code>SDK,配合手机app可以很方便的控制。blinker使用方法请自行搜索，</p>
<p>新建一个blinker设备，获得Secret Key，然后开始编程：<br>需要用到的库：<a href="https://github.com/dancol90/ESP8266Ping" target="_blank" rel="noopener">ESP8266Ping</a>,注意不是arduino仓库里的那个ESP8266-ping，这个要自己下载放到libraries文件夹里。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLINKER_WIFI</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GPIO 0 <span class="comment">//继电器引脚</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLINKER_MIOT_OUTLET</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Blinker.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266Ping.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> pwstate = <span class="literal">false</span>;<span class="comment">//电源状态</span></span><br><span class="line"><span class="function">IPAddress <span class="title">IP</span> <span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">0</span>, <span class="number">104</span>)</span></span>; <span class="comment">//电脑ip，检测是否开机</span></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">"你的key"</span>;<span class="comment">//app中获取到的Secret Key(密钥)</span></span><br><span class="line"><span class="keyword">char</span> ssid[] = <span class="string">"qwweqrq"</span>; <span class="comment">//你的wifi 名称</span></span><br><span class="line"><span class="keyword">char</span> pswd[] = <span class="string">"password"</span>; <span class="comment">//你的wifi 密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建组件对象</span></span><br><span class="line"><span class="function">BlinkerButton <span class="title">Button1</span><span class="params">(<span class="string">"btn-abc"</span>)</span></span>;<span class="comment">//注意：内容替换为app中添加按键的数据键名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按下BlinkerAPP按键即会执行该函数</span></span><br><span class="line"><span class="comment">// 按下按键即会执行该函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">statusreport</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (pwstate)</span><br><span class="line">  &#123;</span><br><span class="line">    Button1.print(<span class="string">"on"</span>);</span><br><span class="line">    BlinkerMIOT.powerState(<span class="string">"on"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    Button1.print(<span class="string">"off"</span>);</span><br><span class="line">    BlinkerMIOT.powerState(<span class="string">"off"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  BlinkerMIOT.print();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isonline</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//  for (int i=0;i&lt;3;i++)</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (Ping.ping(IP)) &#123;</span><br><span class="line">      <span class="comment">//BLINKER_LOG("ping成功！",IP);</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    delay(3000);</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line">  <span class="comment">//BLINKER_LOG("ping失败！",IP);</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heartbeat</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isonline()) pwstate = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> pwstate = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">//BLINKER_LOG("电源状态",pwstate);</span></span><br><span class="line">  statusreport();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">waiteforpwstate</span><span class="params">(<span class="keyword">bool</span> pw)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; pw != (pwstate = isonline()) &amp;&amp; i &lt;= <span class="number">10</span>; i++) <span class="comment">//不满足条件就持续ping，直到30次</span></span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">click</span><span class="params">(<span class="keyword">const</span> String &amp; state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>((state == BLINKER_CMD_ON &amp;&amp;pwstate)||(state == BLINKER_CMD_OFF &amp;&amp; !pwstate)) <span class="keyword">return</span>; <span class="comment">//状态不变的话就不要按下按钮</span></span><br><span class="line">  <span class="comment">//长按1.5s开机</span></span><br><span class="line">  digitalWrite(GPIO, LOW);</span><br><span class="line">  delay(<span class="number">1500</span>);</span><br><span class="line">  digitalWrite(GPIO, HIGH);</span><br><span class="line">  <span class="keyword">if</span> (state == BLINKER_CMD_ON) waiteforpwstate(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">else</span> waiteforpwstate(<span class="literal">false</span>);</span><br><span class="line">  statusreport();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">miotPowerState</span><span class="params">(<span class="keyword">const</span> String &amp; state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  click(state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">button1_callback</span><span class="params">(<span class="keyword">const</span> String &amp; state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  click(state);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">miotQuery</span><span class="params">(<span class="keyword">int32_t</span> queryCode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  statusreport();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// 初始化串口，并开启调试信息，调试用可以删除</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  BLINKER_DEBUG.stream(Serial);</span><br><span class="line">  <span class="comment">// 初始化IO</span></span><br><span class="line">  pinMode(GPIO, OUTPUT);</span><br><span class="line">  digitalWrite(GPIO, HIGH);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//指示灯</span></span><br><span class="line">  <span class="comment">//digitalWrite(LED_BUILTIN, LOW);</span></span><br><span class="line">  <span class="comment">//delay(1500);</span></span><br><span class="line">  <span class="comment">//digitalWrite(LED_BUILTIN, HIGH);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化blinker</span></span><br><span class="line">  Blinker.begin(auth, ssid, pswd);</span><br><span class="line">  Button1.attach(button1_callback);</span><br><span class="line">  Blinker.attachHeartbeat(heartbeat);</span><br><span class="line">  BlinkerMIOT.attachQuery(miotQuery);</span><br><span class="line">  BlinkerMIOT.attachPowerState(miotPowerState);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Blinker.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><p class="tip"><del>Blinker还可以支持小爱同学远程控制，不过我懒得写了，以后再补上</del></p><br>已经添加小爱同学代码，不过由于开关机需要一定时间，小爱同学不能及时感知到操作是否成功。<p></p>
<p>程序的刷写方法可以参考这里：<a href="https://www.diyhobi.com/flash-program-esp-01-using-usb-serial-adapter/" target="_blank" rel="noopener">https://www.diyhobi.com/flash-program-esp-01-using-usb-serial-adapter/</a></p>
<p>接法是这样的：<br><img src="https://coolrc-blog.oss-cn-shenzhen.aliyuncs.com/superbed/2020/09/16/5f6214d9160a154a67895e9a.jpg" alt=""></p>
<p>写好之后，在blinker app立面编辑界面，新增一个按钮，数据键名为<code>btn-abc</code>,<del>类型为普通按键</del>(现在可以选择开关按键，样式选择第二个滑块按钮可以看到机器开关状态)。然后就可以用了<br><img src="https://coolrc-blog.oss-cn-shenzhen.aliyuncs.com/superbed/2020/09/16/5f621601160a154a6789ce67.jpg" alt=""></p>
</div><div class="post-info">last updated: Nov 14, 2020</div><a class="post-info" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">许可协议: "署名-非商用-相同方式共享 4.0" 转载请保留原文链接及作者。</a></article></div></section><footer><nav id="pagination"><a class="prev" href="/2021/05/27/202105271633/"><span>你们这些说西北大学城乡规划系董欣老师论文剽窃的能不能闭嘴啊</span></a><a class="prev" href="/2020/09/13/2020091321/"><span>添加windows-terminal到右键菜单</span></a></nav><div id="vssue"></div><link rel="stylesheet" href="https://unpkg.com/vssue/dist/vssue.min.css"><script src="https://unpkg.com/vue/dist/vue.min.js"></script><script src="https://unpkg.com/vssue/dist/vssue.github.min.js"></script><script>new Vue({
    el: '#vssue',

    data: {
        title: '远程启动不支持网络唤醒的pc',

        options: {
        owner: 'coolrc136',
        repo: 'blog_comment',
        clientId: '54a5c97e932cd5f13660',
        clientSecret: '475f010e505f0b656e6c8d2def4fc46237021a5b', // only required for some of the platforms
        },
    },

    template: `<vssue :title="title" :options="options"></vssue>`,
})</script><div class="copyright"><p>© 2015 - 2021 <a href="https://coolrc.me">coolrc</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p><a href="http://www.beian.miit.gov.cn/" target="_blank">陕ICP备19007986号</a>.</p></div></footer></div></body></html>